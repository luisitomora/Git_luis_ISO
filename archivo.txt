#!/bin/bash

mostrar_menu() {
    echo "Seleccione una opción:"
    echo "  x - Extraer un archivo .tar"
    echo "  a - Añadir todos los .txt a un archivo .tar"
    echo "  c - Crear un .tar desde HOME"
    echo "  v - Visualizar el contenido de un .tar"
    echo "  q - Salir"
    read -p "Opción: " OPC
    echo $OPC
}

# Si NO se pasan opciones, mostrar menú interactivo
if [ $# -eq 0 ]; then
    OPCION=$(mostrar_menu)
else
    # Tomar la opción de la línea de comandos
    while getopts "xacv" opcion; do
        OPCION=$opcion
        TARFILE="${!OPTIND}"  # argumento siguiente a la opción
    done
fi

case $OPCION in
    x)
        if [ -z "$TARFILE" ]; then
            read -p "Ingrese el nombre del archivo .tar a extraer: " TARFILE
        fi
        echo "Extrayendo $TARFILE..."
        tar -xf "$TARFILE"
        ;;

    a)
        if [ -z "$TARFILE" ]; then
            read -p "Ingrese el nombre del archivo .tar donde añadir .txt: " TARFILE
        fi
        echo "Añadiendo archivos .txt al tar $TARFILE..."
        find / -type f -name "*.txt" 2>/dev/null | xargs tar -rf "$TARFILE"
        ;;

    c)
        if [ -z "$TARFILE" ]; then
            read -p "Ingrese el nombre del archivo .tar a crear: " TARFILE
        fi
        echo "Creando tar $TARFILE desde HOME..."
        tar -cf "$TARFILE" "$HOME"
        ;;

    v)
        if [ -z "$TARFILE" ]; then
            read -p "Ingrese el nombre del archivo .tar a visualizar: " TARFILE
        fi
        echo "Contenido del tar $TARFILE:"
        tar -tf "$TARFILE"
        ;;

    q)
        echo "Saliendo..."
        exit 0
        ;;

    *)
        echo "Opción inválida."
        exit 1
        ;;
esac
